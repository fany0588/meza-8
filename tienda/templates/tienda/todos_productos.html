{% extends "tienda/base.html" %}

{% block title %}Todos los Productos - FashionStyle{% endblock %}

{% block content %}
<div class="container">
    <h1>Todos los Productos</h1>
    
    <!-- Filtros -->
    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <h3>Filtros</h3>
        <form method="get" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <label for="categoria">Categoría:</label>
                <select name="categoria" id="categoria" style="width: 100%; padding: 8px;">
                    <option value="">Todas las categorías</option>
                    {% for cat in categorias %}
                    <option value="{{ cat.id }}" {% if request.GET.categoria == cat.id|stringformat:"i" %}selected{% endif %}>
                        {{ cat.nombre }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="precio_min">Precio mínimo:</label>
                <input type="number" name="precio_min" id="precio_min" value="{{ request.GET.precio_min }}" 
                       placeholder="0" style="width: 100%; padding: 8px;">
            </div>
            <div>
                <label for="precio_max">Precio máximo:</label>
                <input type="number" name="precio_max" id="precio_max" value="{{ request.GET.precio_max }}" 
                       placeholder="10000" style="width: 100%; padding: 8px;">
            </div>
            <div style="display: flex; align-items: end;">
                <button type="submit" style="background: #e91e63; color: white; padding: 8px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    Filtrar
                </button>
                <a href="{% url 'todos_productos' %}" style="margin-left: 10px; padding: 8px 15px; border: 1px solid #ddd; border-radius: 5px; text-decoration: none;">
                    Limpiar
                </a>
            </div>
        </form>
    </div>

    <!-- Resultados -->
    {% if productos %}
        <p style="color: #666; margin-bottom: 20px;">
            Mostrando {{ productos.count }} producto{{ productos.count|pluralize }}
            {% if request.GET.categoria or request.GET.precio_min or request.GET.precio_max %}
                (filtrado{{ productos.count|pluralize }})
            {% endif %}
        </p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
            {% for producto in productos %}
            <div style="border: 1px solid #ddd; border-radius: 10px; overflow: hidden; background: white;">
                <div style="height: 200px; overflow: hidden;">
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" 
                             style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                        <div style="width: 100%; height: 100%; background: #f5f5f5; display: flex; align-items: center; justify-content: center; color: #999;">
                            Sin imagen
                        </div>
                    {% endif %}
                </div>
                <div style="padding: 15px;">
                    <h3 style="margin: 0 0 10px 0; color: #e91e63;">{{ producto.nombre }}</h3>
                    <p style="font-size: 1.2rem; font-weight: bold; color: #333; margin: 0 0 10px 0;">
                        ${{ producto.precio }}
                    </p>
                    <p style="color: #666; font-size: 0.9rem; margin: 0 0 10px 0;">
                        {{ producto.categoria.nombre }} • {{ producto.get_tipo_display }}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #888; font-size: 0.8rem;">
                            Talla: {{ producto.get_talla_display }}
                        </span>
                        <a href="{% url 'producto_detalle' producto.id %}" 
                           style="background: #e91e63; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; font-size: 0.9rem;">
                            Ver Detalles
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 10px;">
            <h3 style="color: #666; margin-bottom: 15px;">No se encontraron productos</h3>
            <p style="color: #888; margin-bottom: 20px;">
                {% if request.GET.categoria or request.GET.precio_min or request.GET.precio_max %}
                    Intenta con otros filtros
                {% else %}
                    No hay productos disponibles en este momento
                {% endif %}
            </p>
            <a href="{% url 'todos_productos' %}" 
               style="background: #e91e63; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                Ver Todos los Productos
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}